package com.inventory.myserviceimpl;

import java.util.ArrayList;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.inventory.mydto.StoresDto;
import com.inventory.myentity.Product;
import com.inventory.myentity.ProductDetails;
import com.inventory.myentity.Stores;
import com.inventory.myrepository.ProductDetailsRepo;
import com.inventory.myrepository.ProductRepo;
import com.inventory.myrepository.StoreRepo;
import com.inventory.myservice.StoreService;

@Service
public class StoreServiceImpl implements StoreService {

	@Autowired
	private StoreRepo storeRepo;

	@Autowired
	private ProductDetailsRepo productDetailsRepo;

	@Autowired
	private ProductRepo productRepo;

//	@Override
//	public StoresDto save_stores(StoresDto storesDto) {
//		Stores stores = new Stores(storesDto.getStoreId(), storesDto.getStoreName(), storesDto.getStoreStock(),
//				storesDto.getStoreAddress());
//
//		storeRepo.save(stores);
//
//		StoresDto storesdto = new StoresDto(stores.getStoreId(), stores.getStoreName(), stores.getStoreStock(),
//				stores.getStoreAddress());
//		return storesdto;
//	}

	@Override
	public List<Stores> getStores() {
		List<Stores> list = storeRepo.findAll();
		return list;
	}

	@Override
	public String deleteStore(int id) {
		storeRepo.deleteById(id);
		return "Store deleted successfully";
	}

	@Override
	public StoresDto updateStore(int id, StoresDto storesDto) {
		Stores store = storeRepo.findById(id).get();

		store.setStoreName(storesDto.getStoreName());
		store.setStoreStock(storesDto.getStoreStock());
		store.setStoreAddress(storesDto.getStoreAddress());

		Stores storeSaved = storeRepo.save(store);
		storesDto.setStoreId(storeSaved.getStoreId());
		storesDto.setStoreName(storeSaved.getStoreName());
		storesDto.setStoreAddress(storeSaved.getStoreAddress());
		storesDto.setStoreStock(storeSaved.getStoreStock());

		return storesDto;
	}

	@Override
	public List<StoresDto> buddyStore(String itemNum, String color, String size) {
		Product product = productRepo.findByItemNumber(itemNum);
		System.out.println("product : " + product);
		List<ProductDetails> productDetails = productDetailsRepo.findByProductAndColorAndSize(product, color, size);

		List<Stores> store = new ArrayList<>();
		List<StoresDto> storesDto = new ArrayList<>();
		for (int i = 0; i < productDetails.size(); i++) {
			store.add(storeRepo.findByStoreId(productDetails.get(i).getStore().getStoreId()));
			storesDto.add(new StoresDto(store.get(i).getStoreId(), store.get(i).getStoreName(),
					productDetails.get(i).getSellableStock(), store.get(i).getStoreAddress(),
					productDetails.get(i).getColor(), productDetails.get(i).getPrice(), productDetails.get(i).getSize(),
					productDetails.get(i).getImageData()));
		}

		return storesDto;
	}

	@Override
	public Stores getAllbuddyStores(String sku) {

		List<ProductDetails> productDetails = productDetailsRepo.findAllBySku(sku);

		List<Stores> store = new ArrayList<>();
		List<StoresDto> storesDto = new ArrayList<>();
		for (int i = 0; i < productDetails.size(); i++) {
			store.add(storeRepo.findByStoreId(productDetails.get(i).getStore().getStoreId()));
			storesDto.add(new StoresDto(store.get(i).getStoreId(), store.get(i).getStoreName(),
					productDetails.get(i).getSellableStock(), store.get(i).getStoreAddress(),
					productDetails.get(i).getColor(), productDetails.get(i).getPrice(), productDetails.get(i).getSize(),
					productDetails.get(i).getImageData()));
		}

		return storesDto;
	}

	@Override
	public List<String> getMatchedStores(String store) {
		List<Stores> stores = storeRepo.findByStoreNameContaining(store);
		List<String> storeList = new ArrayList<>();
		for (int i = 0; i < stores.size(); i++) {
			storeList.add(stores.get(i).getStoreName());

		}
		return storeList;
	}
}
